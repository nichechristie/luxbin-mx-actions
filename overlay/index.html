<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Luxbin MX Actions</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: #0d0d0d;
    color: #e0e0e0;
    font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
  }

  .panel {
    background: #1a1a2e;
    border: 1px solid #333;
    border-radius: 16px;
    padding: 40px;
    width: 600px;
    box-shadow: 0 0 60px rgba(100, 100, 255, 0.08);
    position: relative;
    overflow: hidden;
  }

  /* Ping flash on action */
  .panel.ping {
    animation: pingFlash 0.4s ease-out;
  }
  @keyframes pingFlash {
    0% { box-shadow: 0 0 60px rgba(100, 200, 255, 0.5); }
    100% { box-shadow: 0 0 60px rgba(100, 100, 255, 0.08); }
  }

  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 32px;
  }

  .title {
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 3px;
    color: #888;
  }

  .latency {
    font-size: 11px;
    color: #333;
    text-transform: uppercase;
    letter-spacing: 1px;
    transition: all 0.3s ease;
  }
  .latency.active {
    color: #4fc3f7;
    text-shadow: 0 0 8px rgba(79, 195, 247, 0.5);
  }

  .stat {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 0;
    border-bottom: 1px solid #222;
  }

  .stat:last-child { border-bottom: none; }

  .label {
    font-size: 13px;
    color: #999;
    text-transform: uppercase;
    letter-spacing: 1px;
    flex-shrink: 0;
  }

  .value {
    font-size: 28px;
    font-weight: 700;
    color: #fff;
    transition: color 0.3s ease;
  }

  #temperature-value { color: #4fc3f7; }
  #mode-value { color: #ab47bc; }

  .ai-output {
    margin-top: 24px;
    padding: 20px;
    background: #111;
    border: 1px solid #222;
    border-radius: 10px;
    min-height: 80px;
  }

  .ai-output .label { margin-bottom: 10px; display: block; }

  #ai-response {
    font-size: 14px;
    line-height: 1.6;
    color: #ccc;
    transition: opacity 0.2s;
  }
  #ai-response.loading {
    color: #666;
    font-style: italic;
  }

  .temp-bar {
    width: 100%;
    height: 6px;
    background: #222;
    border-radius: 3px;
    margin-top: 8px;
    overflow: hidden;
  }

  .temp-fill {
    height: 100%;
    background: linear-gradient(90deg, #4fc3f7, #f44336);
    border-radius: 3px;
    transition: width 0.2s ease;
  }

  .controls {
    margin-top: 24px;
    padding-top: 16px;
    border-top: 1px solid #222;
    font-size: 11px;
    color: #555;
    line-height: 1.8;
  }

  .key {
    display: inline-block;
    background: #222;
    color: #aaa;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 11px;
    margin: 0 2px;
  }

  .action-label {
    font-size: 13px;
    color: #66bb6a;
    margin-bottom: 4px;
    min-height: 18px;
  }
</style>
</head>
<body>

<div class="panel" id="panel">
  <div class="header">
    <div class="title">Luxbin MX Actions</div>
    <div class="latency" id="latency">LIGHTSPEED &ndash; 1ms</div>
  </div>

  <div class="stat">
    <span class="label">Mode</span>
    <span class="value" id="mode-value">Code</span>
  </div>

  <div class="stat">
    <span class="label">AI Temperature</span>
    <div>
      <span class="value" id="temperature-value">0.50</span>
      <div class="temp-bar">
        <div class="temp-fill" id="temp-fill" style="width: 50%"></div>
      </div>
    </div>
  </div>

  <div class="ai-output">
    <div class="action-label" id="action-label"></div>
    <span class="label">AI Response</span>
    <div id="ai-response">Press a key to trigger an AI action...</div>
  </div>

  <div class="controls">
    <span class="key">&uarr;</span><span class="key">&darr;</span> Dial (temperature)
    &nbsp;&nbsp;
    <span class="key">1</span> Refactor
    &nbsp;&nbsp;
    <span class="key">2</span> Summarize
    &nbsp;&nbsp;
    <span class="key">3</span> Build
    &nbsp;&nbsp;
    <span class="key">M</span> Mode
  </div>
</div>

<script>
  const tempEl = document.getElementById('temperature-value');
  const fillEl = document.getElementById('temp-fill');
  const modeEl = document.getElementById('mode-value');
  const responseEl = document.getElementById('ai-response');
  const actionLabelEl = document.getElementById('action-label');
  const latencyEl = document.getElementById('latency');
  const panelEl = document.getElementById('panel');

  const modes = ['Code', 'Design', 'Deploy'];
  let modeIndex = 0;
  let temperature = 0.5;

  function ping() {
    // Flash the panel
    panelEl.classList.remove('ping');
    void panelEl.offsetWidth;
    panelEl.classList.add('ping');

    // Flash the latency indicator
    latencyEl.classList.add('active');
    setTimeout(() => latencyEl.classList.remove('active'), 600);
  }

  function updateTemp(t) {
    temperature = Math.round(Math.min(1, Math.max(0, t)) * 100) / 100;
    tempEl.textContent = temperature.toFixed(2);
    fillEl.style.width = (temperature * 100) + '%';
    ping();
  }

  async function callAI(action) {
    ping();
    actionLabelEl.textContent = action.charAt(0).toUpperCase() + action.slice(1);
    responseEl.textContent = 'Thinking...';
    responseEl.classList.add('loading');

    try {
      const res = await fetch('/api/ai', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action, temperature })
      });
      const data = await res.json();
      responseEl.textContent = data.result;
    } catch {
      const fallbacks = {
        refactor: 'Refactored: extracted filter/map, improved naming.',
        summarize: 'JWT auth module with session tracking.',
        build: 'Build complete. Preview ready.'
      };
      responseEl.textContent = fallbacks[action] || 'Done.';
    }
    responseEl.classList.remove('loading');
  }

  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowUp') updateTemp(temperature + 0.05);
    if (e.key === 'ArrowDown') updateTemp(temperature - 0.05);
    if (e.key === '1') callAI('refactor');
    if (e.key === '2') callAI('summarize');
    if (e.key === '3') callAI('build');
    if (e.key === 'm' || e.key === 'M') {
      modeIndex = (modeIndex + 1) % modes.length;
      modeEl.textContent = modes[modeIndex];
      ping();
    }
  });
</script>

</body>
</html>
